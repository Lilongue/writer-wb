# Архитектура приложения

Этот документ описывает ключевые архитектурные решения и соглашения, принятые в проекте. Его цель — поддерживать консистентность кода при дальнейшей разработке.

---

## Структура Main-процесса (`src/main`)

Логика основного процесса разделена на несколько слоев для лучшей организации.

### 1. Файлы в корне `src/main`

*   `main.ts`: **Точка входа.** Отвечает за создание окна (`BrowserWindow`), управление жизненным циклом приложения и регистрацию обработчиков `ipcMain`.
*   `menu.ts`: Отвечает за создание и управление нативным меню приложения.
*   `preload.ts`: **Мост безопасности.** Скрипт, который выполняется в контексте `renderer`-процесса, но имеет доступ к API `Node.js`. Используется для безопасного предоставления `ipcRenderer` в React-приложение.
*   `util.ts`: Общие утилитарные функции, не привязанные к конкретной бизнес-логике.

### 2. Сервисный слой (`src/main/services`)

Содержит классы, инкапсулирующие бизнес-логику приложения.

*   `ProjectService.ts`: **Менеджер проектов.**
    *   **Ответственность:** Управление жизненным циклом проекта: создание, открытие, закрытие. Работа с файлами проекта на верхнем уровне (например, `project.sqlite`).
    *   **Не должен:** Содержать логику, специфичную для доменных областей (повествование, мир и т.д.).

*   `NarrativeService.ts`: **Менеджер повествования.**
    *   **Ответственность:** Бизнес-логика, связанная с элементами повествования (части, главы, сцены). Например: создание, переименование, изменение порядка.
    *   **Взаимодействие:** Использует `DAO` для получения и сохранения данных в БД.

*   `FileSystemService.ts`: **Менеджер файловой системы.**
    *   **Ответственность:** Абстракция над модулем `fs`. Предоставляет методы для работы с файлами и папками, которые могут понадобиться другим сервисам.

### 3. Слой доступа к данным (`src/main/data`)

Содержит классы, ответственные за прямое взаимодействие с базой данных.

*   `GenericDao.ts`: **Data Access Object (DAO).**
    *   **Ответственность:** Инкапсуляция всех SQL-запросов к базе данных. Предоставляет CRUD-операции (Create, Read, Update, Delete) для всех сущностей.
    *   **Реализация:** Принимает в конструкторе активное подключение к БД (`better-sqlite3.Database`) и выполняет запросы, возвращая готовые данные.
    *   **Не должен:** Содержать бизнес-логику. Только выполнение запросов.

---

## Общие ресурсы (`src/common`)

*   `types.ts`: **Общие типы данных.** Содержит интерфейсы и типы (`NarrativeItem`, `WorldObject` и т.д.), которые используются в нескольких частях приложения (в `main` и `renderer` процессах, в сервисах и DAO). Это обеспечивает единый источник правды для структур данных.

---

## Структура Renderer-процесса (`src/renderer`)

*   `App.tsx`: Корневой компонент React, управляющий основным состоянием UI (например, `selectedItemId`).
*   `index.tsx`: Точка входа для React-приложения.
*   `components/`: Директория для переиспользуемых React-компонентов (например, `NarrativeTree.tsx`).
