# Журнал разработки

Этот файл содержит хронологию выполненных работ по проекту.

---

## 27 октября 2025 г

* **Актуализация документации:** Проведена ревизия и актуализация планов. Проанализирован список задач `after_maket_to_do.md`, в результате чего был обновлен `features.md` и создан файл `tech_issues.md`. Введена система маркировки реализованных фич.


## 26 октября 2025 г

* **Реализация Шага 6: Управление Объектами мира:**
  * Реализован полный CRUD (создание, переименование, удаление) для Объектов мира на бэкенде (`WorldObjectService`).
  * В `WorldObjectTree` добавлен интерфейс для управления объектами через контекстное меню и модальные окна.
  * Реализована система событий (`world-objects-changed`) для автоматического обновления UI.

* **Исправление критического бага в обновлении UI:**
  * Проведена длительная отладка проблемы, при которой дерево объектов (`WorldObjectTree`) не обновлялось после создания или изменения объекта.
  * Проблема была локализована в стейт-менеджменте React-компонента, где прямая мутация состояния приводила к некорректной работе рендеринга.
  * **Решение:** Проведен рефакторинг `WorldObjectTree.tsx` для использования иммутабельных обновлений. Для гарантированного решения проблемы применена стратегия смены `key` у компонента `Tree`, что принудительно пересоздает его с актуальным состоянием.

## 20 октября 2025 г

* **Реализация Шага 5: Создание и редактирование структуры повествования:**
  * Проведен значительный рефакторинг схемы БД: исправлена логика `parent_id` в `narrative_items` для построения корректной иерархии.
  * Реализован полный CRUD (создание, переименование, удаление) для элементов повествования на бэкенде (`NarrativeService`, `GenericDao`).
  * В `NarrativeTree` добавлен интерфейс для управления элементами через контекстное меню и модальные окна.
  * Реализована система событий (`narrative-changed`) для автоматического обновления дерева.

* **Реализация синхронизации файлов (Шаг 4):**
  * Интегрирована библиотека `chokidar` в `ProjectService` для отслеживания изменений в `*.md` файлах открытого проекта (но потом ее удалили т.к. не работало и реализовано было вручную через поллинг открытого файла).
  * Реализована система событий (`eventBus` -> `ipcRenderer`), которая уведомляет `renderer`-процесс об изменении файла в реальном времени.
  * Компонент `ContentDisplay` теперь подписывается на события изменения и автоматически перезагружает контент, если изменился отображаемый в данный момент файл.

## 19 октября 2025 г

* **Реализация центральной панели (Шаг 3):**
  * Реализована центральная панель для отображения контента выбранного элемента.
  * Добавлена поддержка кастомных полей для "Объектов мира" (персонажей, локаций и т.д.).
  * Реализована логика создания `.md`-файлов "на лету", если они отсутствуют.

* **Исправление ошибок и улучшение кода:**
  * Решена проблема совместимости модулей путем понижения версии `react-markdown`.

* **Реализация списка Объектов мира (Шаг 2.5):**
  * Реализовано отображение объектов мира в виде дерева с динамической ("ленивой") подгрузкой дочерних элементов для обеспечения высокой производительности.
  * Расширен скрипт `seed_test_data.sql` для наполнения базы тестовыми объектами (персонажами, локациями).

## 18 октября 2025 г

* **Интеграция UI:**
  * Проведен анализ и выбрана библиотека Ant Design для ускорения разработки UI.
  * `Ant Design` и `@ant-design/icons` успешно интегрированы в проект.
  * Компонент дерева повествования переведен на `Tree` из Ant Design.
  * Создан скрипт `seed_test_data.sql` для удобного наполнения БД тестовыми данными.

* **Реализация Дерева проекта (Шаг 2):**
  * Реализована полная функциональность (backend и frontend) для отображения иерархической структуры повествования.
  * Интерфейс теперь динамически реагирует на открытие и закрытие проекта.

* **Архитектурные улучшения:**
  * Внедрена шина событий (`eventBus`) в `main`-процессе для улучшения модульности и введена система уведомлений о состоянии проекта.
  * Проведен рефакторинг слоя доступа к данным (`DAO`) для решения проблемы с его инициализацией на старте приложения.

* **Исправление ошибок:**
  * Устранена критическая ошибка, блокировавшая загрузку данных для дерева проекта.

## 13 октября 2025 г

* **Пересмотр архитектуры и планирование:**
  * Проанализирована и обновлена схема БД (`db_scheme.md`, `schema.sql`), формально разделены `narrative_items` и `world_objects`.
  * Добавлены на рассмотрение новые фичи в `features.md` (настройки, переводы, темы).

* **Рефакторинг архитектуры `main` процесса:**
  * Создан документ `docs/architecture.md`, описывающий роли сервисов и слоев приложения.
  * Выделены слои и сервисы доступа к данным (`DAO`) для бизнес-логики повествования и общими типами.

* **Очистка проекта:**
  * Проведена очистка кода от артефактов шаблона и исправлены ошибки типизации TypeScript.

## 12 октября 2025 г

* **Рефакторинг и архитектурные решения:**
  * По предложению выделен `FileSystemService` для инкапсуляции операций с файловой системой.

* **Реализация ядра проекта (Шаг 1):**
  * Реализована основная логика для создания (`create`), открытия (`open`) и закрытия (`close`) проектов в `ProjectService`.
  * Функциональность управления проектами интегрирована в главное меню приложения (`File -> New/Open/Close Project`).

* **Исправление проблем сборки:**
  * Устранена критическая ошибка сборки, связанная с нативным модулем `better-sqlite3`.
  * Проблема решена путем корректного размещения зависимости и отката версии `Electron` до стабильной.

## 11 октября 2025 г

* **Настройка окружения (Шаг 0):**
  * Создан первоначальный макет приложения на основе шаблона `electron-react-boilerplate`.
  * Установлены ключевые зависимости: `better-sqlite3` для работы с базой данных и `chokidar` для отслеживания изменений файлов.

* **Проектирование архитектуры:**
  * Разработан стратегический план для основного сервиса приложения (`ProjectService`).
  * Определена структура и местоположение файлов в основном процессе Electron.

* **Реализация базовой структуры (Шаг 1):**
  * Создан файл схемы базы данных `assets/database/schema.sql`.
  * Создана заготовка класса `ProjectService` в `src/main/services/ProjectService.ts` для управления проектами.
  * Проведена реструктуризация файлов в соответствии с планом.
