# ADR-002: Реализация и обработка кастомных полей

**Статус:** Принято

**Контекст:**

Приложению необходимо отображать не только основное текстовое описание из `.md` файла для объектов мира, но и их структурированные, настраиваемые данные (кастомные поля). В схеме БД для этого предусмотрены `fields_schema` в `entity_templates` и `properties` в `world_objects`. Требовалось определить формат этих данных и способ их обработки на этапе MVP.

**Принятое решение:**

1. **Формат `fields_schema`:** Поле `fields_schema` в таблице `entity_templates` хранит JSON-массив объектов. Каждый объект описывает одно поле и содержит два обязательных ключа:
    * `name`: Системное имя поля (например, "race"). Используется как ключ для хранения значения.
    * `label`: Отображаемое в интерфейсе имя поля (например, "Раса").

2. **Формат `properties`:** Поле `properties` в таблице `world_objects` хранит JSON-объект, где ключами выступают значения `name` из `fields_schema`, а значениями — введенные пользователем данные.

3. **Единый тип данных (Только текст):** Для максимального упрощения реализации на этапе MVP, принято решение, что **все значения кастомных полей считаются текстовыми строками (`string`)**. Поле `type` (например, "number", "date") **не добавляется** в `fields_schema`.

4. **Разделение ответственности:**
    * **Бэкенд (`WorldObjectService`)** отвечает за подготовку данных. Он объединяет `fields_schema` (схемы) и `properties` (значения) в единую, простую структуру, удобную для отображения: массив объектов вида `{ label: string, value: string }`.
    * **Фронтенд (`ContentDisplay.tsx`)** получает уже готовые к отображению данные и не содержит сложной логики сопоставления.

**Последствия:**

* **Положительные:**
  * Логика фронтенда и бэкенда значительно упрощается.
  * Четкое разделение ответственности.
  * Схема данных остается простой и легко расширяемой в будущем.
* **Отрицательные:**
  * Отсутствие валидации типов на уровне данных (например, ввод текста в поле "Возраст"). Это считается приемлемым для MVP.

**Рассмотренные альтернативы:**

* **Введение типизированных полей на этапе MVP:**
  * *Описание:* Предлагалось сразу добавить поле `type` в `fields_schema` (например, `{"type": "number"}`).
  * *Причина отказа:* Это бы неоправданно усложнило реализацию. Решено отложить эту функциональность до момента, когда ее ценность станет очевидной, и реализовать ее как отдельную, сквозную фичу.
